================================================================================
Enhanced SMA Strategy Runner
Started at: 2025-02-28 17:07:20
Logging to: logs\strategy_run_20250228_170720.log
================================================================================

Running enhanced SMA backtest...
Starting enhanced SMA backtest for BTC/USD
Connection pool initialized with 1-10 connections
Successfully acquired connection from pool
Fetching data from 2018-05-20 to 2024-10-20

Fetching data for BTC/USD:
Start: 2018-05-20
End: 2024-10-20
Fetched 56281 hourly records
Date range: 2018-05-20 00:00:00 to 2024-10-20 00:00:00
Optimizing parameters with time series cross-validation...

CV Fold 1/5:
  Training: 2018-05-20 to 2018-08-18
  Validation: 2018-08-18 to 2018-09-17
  Tested 50/840 parameter combinations
  Tested 100/840 parameter combinations
  Tested 150/840 parameter combinations
  Tested 200/840 parameter combinations
  Tested 250/840 parameter combinations
  Tested 300/840 parameter combinations
  Tested 350/840 parameter combinations
  Tested 400/840 parameter combinations
  Tested 450/840 parameter combinations
  Tested 500/840 parameter combinations
  Tested 550/840 parameter combinations
  Tested 600/840 parameter combinations
  Tested 650/840 parameter combinations
  Tested 700/840 parameter combinations
  Tested 750/840 parameter combinations
  Tested 800/840 parameter combinations
  Tested 840/840 parameter combinations
  Best parameters for fold 1:
    {'vol_method': 'standard', 'vol_lookback': 90, 'short_window': 8, 'long_window': 21}
  Best score: 3.9111
  Sharpe: 6.3496, Sortino: 4.1548, Calmar: 0.4162
  Return: 16.7691%, Max DD: -1.6331%

CV Fold 2/5:
  Training: 2018-05-20 to 2018-09-17
  Validation: 2018-09-17 to 2018-10-17
  Tested 50/840 parameter combinations
  Tested 100/840 parameter combinations
  Tested 150/840 parameter combinations
  Tested 200/840 parameter combinations
  Tested 250/840 parameter combinations
  Tested 300/840 parameter combinations
  Tested 350/840 parameter combinations
  Tested 400/840 parameter combinations
  Tested 450/840 parameter combinations
  Tested 500/840 parameter combinations
  Tested 550/840 parameter combinations
  Tested 600/840 parameter combinations
  Tested 650/840 parameter combinations
  Tested 700/840 parameter combinations
  Tested 750/840 parameter combinations
  Tested 800/840 parameter combinations
  Tested 840/840 parameter combinations
  Best parameters for fold 2:
    {'vol_method': 'parkinson', 'vol_lookback': 120, 'short_window': 5, 'long_window': 377}
  Best score: 2.9159
  Sharpe: 4.6623, Sortino: 3.2969, Calmar: 0.2062
  Return: 16.4558%, Max DD: -2.4412%

CV Fold 3/5:
  Training: 2018-05-20 to 2018-10-17
  Validation: 2018-10-17 to 2018-11-16
  Tested 50/840 parameter combinations
  Tested 100/840 parameter combinations
  Tested 150/840 parameter combinations
  Tested 200/840 parameter combinations
  Tested 250/840 parameter combinations
  Tested 300/840 parameter combinations
  Tested 350/840 parameter combinations
  Tested 400/840 parameter combinations
  Tested 450/840 parameter combinations
  Tested 500/840 parameter combinations
  Tested 550/840 parameter combinations
  Tested 600/840 parameter combinations
  Tested 650/840 parameter combinations
  Tested 700/840 parameter combinations
  Tested 750/840 parameter combinations
  Tested 800/840 parameter combinations
  Tested 840/840 parameter combinations
  Best parameters for fold 3:
    {'vol_method': 'garch', 'vol_lookback': 90, 'short_window': 8, 'long_window': 21}
  Best score: 2.1073
  Sharpe: 3.6830, Sortino: 2.0268, Calmar: 0.0870
  Return: 14.9593%, Max DD: -4.2518%

CV Fold 4/5:
  Training: 2018-05-20 to 2018-11-16
  Validation: 2018-11-16 to 2018-12-16
  Tested 50/840 parameter combinations
  Tested 100/840 parameter combinations
  Tested 150/840 parameter combinations
  Tested 200/840 parameter combinations
  Tested 250/840 parameter combinations
  Tested 300/840 parameter combinations
  Tested 350/840 parameter combinations
  Tested 400/840 parameter combinations
  Tested 450/840 parameter combinations
  Tested 500/840 parameter combinations
  Tested 550/840 parameter combinations
  Tested 600/840 parameter combinations
  Tested 650/840 parameter combinations
  Tested 700/840 parameter combinations
  Tested 750/840 parameter combinations
  Tested 800/840 parameter combinations
  Tested 840/840 parameter combinations
  Best parameters for fold 4:
    {'vol_method': 'standard', 'vol_lookback': 90, 'short_window': 8, 'long_window': 21}
  Best score: 2.3694
  Sharpe: 3.9769, Sortino: 2.4976, Calmar: 0.0980
  Return: 22.4034%, Max DD: -4.5569%

CV Fold 5/5:
  Training: 2018-05-20 to 2018-12-16
  Validation: 2018-12-16 to 2019-01-15
  Tested 50/840 parameter combinations
  Tested 100/840 parameter combinations
  Tested 150/840 parameter combinations
  Tested 200/840 parameter combinations
  Tested 250/840 parameter combinations
  Tested 300/840 parameter combinations
  Tested 350/840 parameter combinations
  Tested 400/840 parameter combinations
  Tested 450/840 parameter combinations
  Tested 500/840 parameter combinations
  Tested 550/840 parameter combinations
  Tested 600/840 parameter combinations
  Tested 650/840 parameter combinations
  Tested 700/840 parameter combinations
  Tested 750/840 parameter combinations
  Tested 800/840 parameter combinations
  Tested 840/840 parameter combinations
  Best parameters for fold 5:
    {'vol_method': 'garch', 'vol_lookback': 120, 'short_window': 55, 'long_window': 377}
  Best score: 2.7109
  Sharpe: 4.9313, Sortino: 2.3809, Calmar: 0.0805
  Return: 24.9925%, Max DD: -5.2503%

Parameter stability score: 0.5563

Top 5 parameter sets across all folds:
1. {'vol_method': 'standard', 'vol_lookback': 90, 'short_window': 8, 'long_window': 21}
   Avg Score: 2.7089, Folds: 5/5
   Avg Sharpe: 4.5507, Avg Sortino: 2.7835, Avg Calmar: 0.1786
   Avg Return: 19.4469%, Avg Max DD: -3.3971%
   Final Score (with stability): 1.6326
2. {'vol_method': 'parkinson', 'vol_lookback': 90, 'short_window': 8, 'long_window': 21}
   Avg Score: 2.5669, Folds: 5/5
   Avg Sharpe: 4.2083, Avg Sortino: 2.7737, Avg Calmar: 0.1716
   Avg Return: 18.1431%, Avg Max DD: -3.1072%
   Final Score (with stability): 1.5616
3. {'vol_method': 'yang_zhang', 'vol_lookback': 90, 'short_window': 8, 'long_window': 21}
   Avg Score: 2.4936, Folds: 5/5
   Avg Sharpe: 4.0410, Avg Sortino: 2.7556, Avg Calmar: 0.1686
   Avg Return: 17.7733%, Avg Max DD: -3.0404%
   Final Score (with stability): 1.5250
4. {'vol_method': 'garch', 'vol_lookback': 90, 'short_window': 5, 'long_window': 377}
   Avg Score: 2.4294, Folds: 5/5
   Avg Sharpe: 4.4168, Avg Sortino: 2.1094, Avg Calmar: 0.0996
   Avg Return: 15.4961%, Avg Max DD: -4.1338%
   Final Score (with stability): 1.4929
5. {'vol_method': 'garch', 'vol_lookback': 90, 'short_window': 8, 'long_window': 21}
   Avg Score: 2.3739, Folds: 5/5
   Avg Sharpe: 4.0631, Avg Sortino: 2.3567, Avg Calmar: 0.1390
   Avg Return: 15.3085%, Avg Max DD: -3.1620%
   Final Score (with stability): 1.4651

Selected best parameters: {'vol_method': 'standard', 'vol_lookback': 90, 'short_window': 8, 'long_window': 21}
Applying enhanced SMA strategy with HMM regime detection and unified risk management...

REGIME DISTRIBUTION (DEBUGGING):
Regime 0: 16862 periods (50.62%)
Regime 1: 8709 periods (26.14%)
Regime 2: 7742 periods (23.24%)

RAW SIGNAL DISTRIBUTION (DEBUGGING):
Signal 1: 16921 periods (50.79%)
Signal -1: 16372 periods (49.15%)
Signal 0: 20 periods (0.06%)

FILTERED SIGNAL DISTRIBUTION (DEBUGGING):
Signal 0: 16167 periods (48.53%)
Signal 1: 8921 periods (26.78%)
Signal -1: 8225 periods (24.69%)

REGIME OPT-OUT SETTINGS (DEBUGGING):
Regime 0: Trading enabled
Regime 1: Trading enabled
Regime 2: Trading enabled

POSITION SIZING DEBUG:
Target volatility: 0.15
Min size: 0.1, Max size: 1.0
Materiality threshold: 0.05

REGIME ADJUSTMENT FACTORS:
Regime 0: Average factor = 1.00
Regime 1: Average factor = 0.80
Regime 2: Average factor = 0.50

Zero positions before opt-out: 0
Zero positions after regime adjustment: 0
Zero positions after clipping: 0
Zero positions after final opt-out: 0
Zero positions after rebalancing: 0

Final position sizing stats:
Min: 0.1
Max: 1.0
Mean: 0.2895
Zero positions: 0 out of 33313

POSITION SIZE STATS (DEBUGGING):
Zero position size: 0 periods (0.00%)
Min position size: 0.1
Max position size: 1.0
Mean position size: 0.28945491359563974

SIZED POSITION DISTRIBUTION (DEBUGGING):
Zero positions: 20256 periods (60.81%)
Non-zero positions: 13057 periods
Positive positions: 6972 periods
Negative positions: 6085 periods

Risk Management Exit Summary:
Max Drawdown Exits: 2
Profit Taking Exits: 0
Trailing Stop Exits: 0
Total Trades: 1428

Strategy applied with 2364 trades
Connection returned to pool.

===== Test Results =====
Total Return: 17.9931%
Annualized Return: 4.4470%
Volatility: 1.7804%
Max Drawdown: -18.1734%
Sharpe Ratio: -0.1506
Sortino Ratio: 0.3227
Calmar Ratio: 0.0029
Win Rate: 48.5649%
Gain-to-Pain Ratio: 1.0263
Buy & Hold Return: 134.8010%
Outperformance: -116.8080%
Results plot saved to enhanced_sma_results\enhanced_sma_results_BTC_USD.png
Results saved to enhanced_sma_results\enhanced_sma_results_BTC_USD.txt
Data saved to enhanced_sma_results\enhanced_sma_data_BTC_USD.csv
Model saved to enhanced_sma_results\enhanced_sma_model_BTC_USD.pkl

Total execution time: 53.33 minutes

Execution complete!
Total runtime: 53.33 minutes

Strategy Summary:
  Total Return: 17.99%
  Sharpe Ratio: -0.15
  Max Drawdown: -18.17%
  Win Rate: 48.56%

Log file saved to: logs\strategy_run_20250228_170720.log
================================================================================
